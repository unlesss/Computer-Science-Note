## 分库分表
	只分库不分表、只分表不分库、既分库又分表

### 三种情况

1. 分库：读或者写的QPS过高，导致你的数据库连接数不足了的时候，就需要考虑分库了，通过增加数据库实例的方式来提供更多的可用数据库链接，从而提升系统的并发度。
2. 分表：主要解决的是数据量大的问题，存储和查询的性能遇到了瓶颈，将数据拆分到多张表中，来减少单表的数据量，从而提升查询速度
3. 既分库又分表：既需要解决并发量大的问题，又需要解决数据量大的问题

### 拆分方法

1. 纵向拆分：一条记录的多个字段，拆分到多张表中
2. 横向拆分：一张表中的不同记录放在不同表中

### 分表字段的选择
	避免数据倾斜，某张表的数据量大，数据成为热点，造成操作缓慢
设定规则

### 分表算法

1. 直接取模
2. Hash取模
3. 一致性Hash：常用的hash算法来将对应的key哈希到一个具有2^32次方个节点的空间中，形成成一个顺时针首尾相接的闭合的环形。所以当添加一台新的数据库服务器时，只有增加服务器的位置和逆时针方向第一台服务器之间的键会受影响。
![[Pasted image 20240615235320.png]]
### 全局ID生成

#### UUID
	UUID太长了，其次字符串的查询效率也比较慢，而且没有业务含义
1. 基于某个单表做自增主键（存在单点问题）
2. 多个单表+步长做自增主键
3. 雪花算法

### 工具

Sharding-JDBC
现在叫ShardingSphere(Sharding-JDBC、Sharding-Proxy和Sharding-Sidecar这3款相互独立的产品组成)。它定位为轻量级Java框架，在Java的JDBC层提供的额外服务。它使用客户端直连数据库，以jar包形式提供服务，无需额外部署和依赖，可理解为增强版的JDBC驱动，完全兼容JDBC和各种ORM框架。

开原地址：https://shardingsphere.apache.org

TDDL
TDDL 是淘宝开源的一个用于访问数据库的中间件， 它集成了分库分表， 读写分离，权重调配，动态数据源配置等功能。封装 jdbc 的 DataSource给用户提供统一的基于客户端的使用。

开源地址：https://github.com/alibaba/tb_tddl

Mycat
Mycat是一款分布式关系型数据库中间件。它支持分布式SQL查询，兼容MySQL通信协议，以Java生态支持多种后端数据库，通过数据分片提高数据查询处理能力。

## 问题
库分表之后，会带来很多问题。

首先，做了分库分表之后，所有的读和写操作，都需要带着分表字段，这样才能知道具体去哪个库、哪张表中去查询数据。如果不带的话，就得支持全表扫描。

但是，单表的时候全表扫描比较容易，但是做了分库分表之后，就没办法做扫表的操作了，如果要扫表的话就要把所有的物理表都要扫一遍。

还有，一旦我们要从多个数据库中查询或者写入数据，就有很多事情都不能做了，比如跨库事务就是不支持的。



所以，分库分表之后就会带来因为不支持事务而导致的数据一致性的问题。

其次，做了分库分表之后，以前单表中很方便的分页查询、排序等等操作就都失效了。因为我们不能跨多表进行分页、排序。

总之，分库分表虽然能解决一些大数据量、高并发的问题，但是同时也会带来一些新的问题。所以，在做数据库优化的时候，还是建议大家优先选择其他的优化方式，最后再考虑分库分表。