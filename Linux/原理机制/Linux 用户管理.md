
# ID
	登陆的使用者至少都会取得两个 ID ，一个是使用者 ID (User ID ，简称 UID)、一个是群组 ID (Group ID ，简称 GID)


系统会依据 **/etc/passwd** 与 **/etc/group** 的内容， 找到 UID / GID 对应的账号与组名

## 使用者账号
	输入账号密码之后，系统行为

1. 先找寻 /etc/passwd 里面是否有你输入的账号？如果没有则跳出，如果有的话则将该账号对应的 UID 与 GID (在 /etc/group 中) 读出来，另外，该账号的家目录与 shell 配置也一并读出；
2. 再则是核对口令表，这时 Linux 会进入 /etc/shadow 里面找出对应的账号与 UID，然后核对一下你刚刚输入的口令与里头的口令是否相符？
3. 进入 Shell 控管的阶段

## /etc/passwd 文件结构

每一行都代表一个账号，很多账号是系统正常运行所必须要的，简称为**系统账号**。

1. 账号名称：用来对应 UID
2. 口令：早期 Unix 系统的口令就是放在这字段上，但是因为这个文件的特性是所有的程序都能够读取，这样一来**很容易造成口令数据被窃取**， 因此后来就将这个字段的口令数据给他改放到 **/etc/shadow** 中了。所以这里你会看到一个『 x 』。
3. UID：使用者标识符
### Linux对UID的限制

| id范围                 | 使用者特性                                                                                                          |
| :------------------- | :------------------------------------------------------------------------------------------------------------- |
| 0<br>(系统管理员)         | 当你要让其他的账号名称也具有 root 的权限时，将该账号的 UID 改为 0 即可。 这也就是说，一部系统上面的系统管理员不见得只有 root                                       |
| 1~499<br>(系统账号)      | 其他的 UID 权限与特性并没有不一样，由于系统上面启动的服务希望使用较小的权限去运行，因此不希望使用 root 的身份去运行这些服务， 所以我们就得要提供这些运行中**程序的拥有者账号**，这些系统账号通常是不可登陆的 |
| 500~65535<br>(可登陆账号) | 一般使用者，目前已经支持 2^32 -1                                                                                           |

4. GID：与 /etc/group 有关，用来规范组名与 GID 的对应
5. 用户信息说明：解释这个账号的意义而已，如果您提供使用 finger 的功能时， 这个字段可以提供很多的信息
6. 家目录：如果你有个账号的使用空间特别的大，你想要将该账号的家目录移动到其他的硬盘去，可以在这个字段进行修改，默认的用户家目录在 /home/yourIDname
7. Shell：与系统的核心沟通以进行用户的操作任务，有一个 shell 可以用来替代成让账号无法取得 shell 环境的登陆动作！那就是 /sbin/nologin 


## /etc/shadow 文件结构

1. 账号名称：必须要与 /etc/passwd 相同
2. 口令：真正的口令，而且是经过编码的口令 (加密)——这个文件的默认权限是『-rw-------』或者是『-r--------』，亦即只有 root 才可以读写。口令编码方式不同，其长度不同，改变长度后，无法解密。
3. **最近更改口令**的日期：计算 Linux 日期的时间是以 1970 年 1 月 1 日作为 1 而累加的日期
4. 口令**不可被更动**的天数：(与第 3 字段相比)这个账号的口令在最近一次被更改后需要经过几天才可以再被变更！如果是 0 的话， 表示口令随时可以更动的意思。
5. 口令需要**重新变更**的天数：(与第 3 字段相比)可以指定在最近一次更改口令后， 在多少天数内需要再次的变更口令，否则这个账号的口令将会『变为过期特性』
6. 口令需要**变更期限前的警告天数**：(与第 5 字段相比)
7. 口令过期后的账号宽限时间(口令失效日)：是在口令过期几天后，如果使用者还是没有登陆更改口令，那么这个账号的口令将会『失效』， 亦即该账号再也无法使用该口令登陆了。要注意口令过期与口令失效并不相同。
8. 账号失效日期：都是使用 1970 年以来的总日数配置。这个字段表示： 这个账号在此字段规定的日期之后，将无法再使用
9. 保留

## 忘记密码

1. 一般用户的口令忘记了：这个最容易解决，请系统管理员帮忙， 他会重新配置好你的口令而不需要知道你的旧口令！利用 root 的身份使用 passwd 命令来处理即可。

2. root 口令忘记了：这就麻烦了！因为你无法使用 root 的身份登陆了嘛！ 但我们知道 root 的口令在 /etc/shadow 当中，因此你可以使用各种可行的方法启动进入 Linux 再去修改。 例如重新启动进入单人维护模式后，系统会主动的给予 root 权限的 bash 接口， 此时再以 passwd 修改口令即可；或以 Live CD 启动后挂载根目录去修改 /etc/shadow，将里面的 root 的口令字段清空， 再重新启动后 root 将不用口令即可登陆！登陆后再赶快以 passwd 命令去配置 root 口令即可

# 群组

## /etc/group文件结构
	文件每一行代表一个群组

1. 组名
2. 群组口令：通常不需要配置，这个配置通常是给『群组管理员』使用的，同样的，口令已经移动到 /etc/gshadow 去，因此这个字段只会存在一个『x』
3. GID：群组ID
4. 此群组支持的账号名称：某个账号想要加入此群组时，将该账号填入这个字段即可

![[Pasted image 20240403162804.png]]

## 有效群组和初始群组

 每个使用者在他的 /etc/passwd 里面的第四栏GID 吧？那个 GID 就是『初始群组 (initial group) 』，也就是说，当用户一登陆系统，立刻就拥有这个群组的相关权限

### groups 
	查看当前登陆者所属所有群组

第一个输出的群组即为有效群组 (effective group) 了

通常有效群组的作用是在新建文件

### newgrp
	有效群组的切换

使用 newgrp 是有限制的，那就是你想要切换的群组必须是你已经有支持的群组
	是另外以一个 shell 来提供这个功能

![[Pasted image 20240403163822.png]]

## /etc/gshadow文件结构

1. 组名
2. 口令栏，同样的，开头为 ! 表示无合法口令，所以无群组管理员
3. 群组管理员的账号 (相关信息在 gpasswd 中介绍)
4. 该群组的所属账号 (与 /etc/group 内容相同！)



